<?php
/**
 * Generated by Haxe 4.0.3
 */

namespace helder\std\haxe\xml;

use \helder\std\php\Boot;
use \helder\std\Xml;
use \helder\std\_Xml\XmlType_Impl_;
use \helder\std\php\_Boot\HxException;
use \helder\std\EReg;
use \helder\std\StringBuf;
use \helder\std\_Array\ArrayIterator;

/**
 * This class provides utility methods to convert Xml instances to
 * String representation.
 */
class Printer {
	/**
	 * @var StringBuf
	 */
	public $output;
	/**
	 * @var bool
	 */
	public $pretty;

	/**
	 * Convert `Xml` to string representation.
	 * Set `pretty` to `true` to prettify the result.
	 * 
	 * @param Xml $xml
	 * @param bool $pretty
	 * 
	 * @return string
	 */
	public static function print ($xml, $pretty = false) {
		#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:35: lines 35-39
		if ($pretty === null) {
			$pretty = false;
		}
		#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:36: characters 3-37
		$printer = new Printer($pretty);
		#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:37: characters 3-29
		$printer->writeNode($xml, "");
		#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:38: characters 3-35
		return $printer->output->b;
	}

	/**
	 * @param bool $pretty
	 * 
	 * @return void
	 */
	public function __construct ($pretty) {
		#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:45: characters 3-27
		$this->output = new StringBuf();
		#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:46: characters 3-23
		$this->pretty = $pretty;
	}

	/**
	 * @param Xml $value
	 * 
	 * @return bool
	 */
	public function hasChildren ($value) {
		#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:115: characters 17-22
		if (($value->nodeType !== Xml::$Document) && ($value->nodeType !== Xml::$Element)) {
			throw new HxException("Bad node type, expected Element or Document but found " . (XmlType_Impl_::toString($value->nodeType)??'null'));
		}
		$child = new ArrayIterator($value->children);
		while ($child->hasNext()) {
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:115: lines 115-125
			$child1 = $child->next();
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:116: characters 12-26
			$__hx__switch = ($child1->nodeType);
			if ($__hx__switch === 0 || $__hx__switch === 1) {
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:118: characters 6-17
				return true;
			} else if ($__hx__switch === 2 || $__hx__switch === 3) {
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:120: characters 28-43
				if (($child1->nodeType === Xml::$Document) || ($child1->nodeType === Xml::$Element)) {
					throw new HxException("Bad node type, unexpected " . (XmlType_Impl_::toString($child1->nodeType)??'null'));
				}
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:120: lines 120-122
				if (mb_strlen(ltrim($child1->nodeValue)) !== 0) {
					#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:121: characters 7-18
					return true;
				}
			} else {
			}
		}

		#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:126: characters 3-15
		return false;
	}

	/**
	 * @return void
	 */
	public function newline () {
		#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:109: lines 109-111
		if ($this->pretty) {
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:110: characters 4-20
			$this->output->add("\x0A");
		}
	}

	/**
	 * @param string $input
	 * 
	 * @return void
	 */
	public function write ($input) {
		#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:105: characters 3-20
		$this->output->add($input);
	}

	/**
	 * @param Xml $value
	 * @param string $tabs
	 * 
	 * @return void
	 */
	public function writeNode ($value, $tabs) {
		#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:50: characters 11-25
		$__hx__switch = ($value->nodeType);
		if ($__hx__switch === 0) {
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:68: characters 5-22
			$this->output->add(($tabs??'null') . "<");
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:69: characters 11-25
			if ($value->nodeType !== Xml::$Element) {
				throw new HxException("Bad node type, expected Element but found " . (XmlType_Impl_::toString($value->nodeType)??'null'));
			}
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:69: characters 5-26
			$this->output->add($value->nodeName);

			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:70: characters 23-41
			$attribute = $value->attributes();
			while ($attribute->hasNext()) {
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:70: lines 70-74
				$attribute1 = $attribute->next();
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:71: characters 6-36
				$this->output->add(" " . ($attribute1??'null') . "=\"");
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:72: characters 6-63
				$input = htmlspecialchars($value->get($attribute1), ENT_QUOTES | ENT_HTML401);
				$this->output->add($input);

				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:73: characters 6-17
				$this->output->add("\"");
			}

			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:75: lines 75-88
			if ($this->hasChildren($value)) {
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:76: characters 6-16
				$this->output->add(">");
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:77: characters 6-15
				if ($this->pretty) {
					$this->output->add("\x0A");
				}
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:78: characters 20-25
				if (($value->nodeType !== Xml::$Document) && ($value->nodeType !== Xml::$Element)) {
					throw new HxException("Bad node type, expected Element or Document but found " . (XmlType_Impl_::toString($value->nodeType)??'null'));
				}
				$child = new ArrayIterator($value->children);
				while ($child->hasNext()) {
					#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:78: lines 78-80
					$child1 = $child->next();
					#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:79: characters 7-52
					$this->writeNode($child1, ($this->pretty ? ($tabs??'null') . "\x09" : $tabs));
				}

				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:81: characters 6-24
				$this->output->add(($tabs??'null') . "</");
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:82: characters 12-26
				if ($value->nodeType !== Xml::$Element) {
					throw new HxException("Bad node type, expected Element but found " . (XmlType_Impl_::toString($value->nodeType)??'null'));
				}
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:82: characters 6-27
				$this->output->add($value->nodeName);

				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:83: characters 6-16
				$this->output->add(">");
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:84: characters 6-15
				if ($this->pretty) {
					$this->output->add("\x0A");
				}
			} else {
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:86: characters 6-17
				$this->output->add("/>");
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:87: characters 6-15
				if ($this->pretty) {
					$this->output->add("\x0A");
				}
			}
		} else if ($__hx__switch === 1) {
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:90: characters 28-43
			if (($value->nodeType === Xml::$Document) || ($value->nodeType === Xml::$Element)) {
				throw new HxException("Bad node type, unexpected " . (XmlType_Impl_::toString($value->nodeType)??'null'));
			}
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:90: characters 5-44
			$nodeValue = $value->nodeValue;
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:91: lines 91-94
			if (mb_strlen($nodeValue) !== 0) {
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:92: characters 6-53
				$input1 = ($tabs??'null') . (htmlspecialchars($nodeValue, (null ? ENT_QUOTES | ENT_HTML401 : ENT_NOQUOTES))??'null');
				$this->output->add($input1);

				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:93: characters 6-15
				if ($this->pretty) {
					$this->output->add("\x0A");
				}
			}
		} else if ($__hx__switch === 2) {
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:52: characters 5-30
			$this->output->add(($tabs??'null') . "<![CDATA[");
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:53: characters 11-26
			if (($value->nodeType === Xml::$Document) || ($value->nodeType === Xml::$Element)) {
				throw new HxException("Bad node type, unexpected " . (XmlType_Impl_::toString($value->nodeType)??'null'));
			}
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:53: characters 5-27
			$this->output->add($value->nodeValue);

			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:54: characters 5-17
			$this->output->add("]]>");
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:55: characters 5-14
			if ($this->pretty) {
				$this->output->add("\x0A");
			}
		} else if ($__hx__switch === 3) {
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:57: characters 33-48
			if (($value->nodeType === Xml::$Document) || ($value->nodeType === Xml::$Element)) {
				throw new HxException("Bad node type, unexpected " . (XmlType_Impl_::toString($value->nodeType)??'null'));
			}
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:57: characters 5-49
			$commentContent = $value->nodeValue;
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:58: characters 5-63
			$commentContent = (new EReg("[\x0A\x0D\x09]+", "g"))->replace($commentContent, "");
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:59: characters 5-53
			$commentContent = "<!--" . ($commentContent??'null') . "-->";
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:60: characters 5-16
			$this->output->add($tabs);
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:61: characters 5-44
			$input2 = trim($commentContent);
			$this->output->add($input2);

			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:62: characters 5-14
			if ($this->pretty) {
				$this->output->add("\x0A");
			}
		} else if ($__hx__switch === 4) {
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:99: characters 26-41
			if (($value->nodeType === Xml::$Document) || ($value->nodeType === Xml::$Element)) {
				throw new HxException("Bad node type, unexpected " . (XmlType_Impl_::toString($value->nodeType)??'null'));
			}
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:99: characters 5-48
			$this->output->add("<!DOCTYPE " . ($value->nodeValue??'null') . ">");

			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:100: characters 5-14
			if ($this->pretty) {
				$this->output->add("\x0A");
			}
		} else if ($__hx__switch === 5) {
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:96: characters 18-33
			if (($value->nodeType === Xml::$Document) || ($value->nodeType === Xml::$Element)) {
				throw new HxException("Bad node type, unexpected " . (XmlType_Impl_::toString($value->nodeType)??'null'));
			}
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:96: characters 5-41
			$this->output->add("<?" . ($value->nodeValue??'null') . "?>");

			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:97: characters 5-14
			if ($this->pretty) {
				$this->output->add("\x0A");
			}
		} else if ($__hx__switch === 6) {
			#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:64: characters 19-24
			if (($value->nodeType !== Xml::$Document) && ($value->nodeType !== Xml::$Element)) {
				throw new HxException("Bad node type, expected Element or Document but found " . (XmlType_Impl_::toString($value->nodeType)??'null'));
			}
			$child2 = new ArrayIterator($value->children);
			while ($child2->hasNext()) {
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:64: lines 64-66
				$child3 = $child2->next();
				#/home/runner/haxe/versions/4.0.3/std/haxe/xml/Printer.hx:65: characters 6-28
				$this->writeNode($child3, $tabs);
			}
		}
	}
}

Boot::registerClass(Printer::class, 'haxe.xml.Printer');
